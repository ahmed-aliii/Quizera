@model List<AttemptIndexViewModel>
@using Microsoft.AspNetCore.Identity

@{
    ViewData["Title"] = "Exam Attempts";
}

<div class="container mt-5">
    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center rounded-top-4">
            <h4 class="mb-0"><i class="bi bi-clipboard-data"></i> Exam Attempts</h4>

            @if (User.IsInRole("Instructor"))
            {
                <a asp-controller="Exam" asp-action="Index" class="btn btn-light btn-sm fw-semibold">
                    <i class="bi bi-journal-text"></i> Manage Exams
                </a>
            }
            else if (User.IsInRole("Student"))
            {
                <a asp-controller="Exam" asp-action="Index" class="btn btn-success btn-sm fw-semibold">
                    <i class="bi bi-play-circle"></i> Start New Exam
                </a>
            }
        </div>

        <div class="card-body bg-light">
            @if (!Model.Any())
            {
                <div class="alert alert-info text-center mb-0 rounded-3 shadow-sm">
                    <i class="bi bi-info-circle"></i> No attempts found yet.
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-primary text-center">
                            <tr>
                                <th>#</th>
                                <th>Student</th>
                                <th>Exam</th>
                                <th>Score</th>
                                <th>Total Marks</th>
                                <th>Started At</th>
                                <th>Finished At</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var attempt in Model)
                            {
                                <tr class="text-center">
                                    <td class="fw-semibold text-secondary">@attempt.AttemptId</td>
                                    <td>@attempt.UserName</td>
                                    <td>@attempt.ExamTitle</td>
                                    <td>
                                        @if (attempt.Score.HasValue)
                                        {
                                            <span class="badge bg-success-subtle text-success fw-bold">
                                                @attempt.Score.Value.ToString("F2")
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td class="fw-semibold">@attempt.TotalMarks</td>
                                    <td class="text-muted small">@attempt.StartedAt.ToString("g")</td>
                                    <td class="text-muted small">@((attempt.FinishedAt?.ToString("g")) ?? "-")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <div class="card-footer bg-white text-center rounded-bottom-4">
            <small class="text-muted">
                <i class="bi bi-clock-history"></i> Last updated @DateTime.Now.ToString("g")
            </small>
        </div>
    </div>
</div>
